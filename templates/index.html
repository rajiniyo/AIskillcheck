<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Check Your Job's AI Risk</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#0f172a; --bg2:#111827; --glass:rgba(255,255,255,.06);
  --accent1:#60a5fa; --accent2:#a78bfa; --accent3:#f472b6;
  --ok:#22c55e; --med:#f59e0b; --bad:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:#e5e7eb;
  min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:32px;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
}
.shell{ width:min(1200px,100%); margin:12px auto; position:relative; }
.hero{ padding:28px 24px 4px; text-align:center; }
.title{
  font-weight:800; font-size:clamp(28px,4.5vw,48px); margin:0;
  background: linear-gradient(90deg, var(--accent1), var(--accent2), var(--accent3));
  -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
}
.subtitle{opacity:.85; margin-top:8px; font-size:clamp(14px,1.4vw,16px)}
.panel{
  margin-top:18px; background:var(--glass); border:1px solid rgba(255,255,255,.08);
  border-radius:20px; padding:20px; backdrop-filter: blur(14px);
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
form.query{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
.input{
  flex:1 1 360px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  color:#fff; padding:14px 16px; border-radius:14px; outline:none; font-size:16px;
  transition: .25s background, .25s box-shadow, .25s border;
}
.input::placeholder{color:#9ca3af}
.input:focus{background:rgba(255,255,255,.12); border-color:rgba(96,165,250,.6); box-shadow:0 0 0 6px rgba(96,165,250,.15)}
.btn{
  appearance:none; border:0; border-radius:14px; padding:14px 20px; font-weight:700; font-size:16px;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  color:#0b1220; cursor:pointer; transition:transform .15s ease, filter .15s ease;
  text-decoration:none; text-align:center; display:inline-block;
}
.btn:hover{transform:translateY(-1px)}
.btn:active{transform:translateY(0)}
.btn[disabled]{opacity:.6; cursor:not-allowed; filter:grayscale(20%)}

.grid{display:grid; gap:24px; grid-template-columns:1fr; margin-top:20px;}
.card{
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:20px;
  transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
  position: relative;
}
.card:hover{
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  border-color: rgba(255,255,255,.08);
}
.meter-container{ display:flex; justify-content:center; align-items:center; }
.meter{
  position:relative;
  width:120px; height:120px;
  border-radius:50%;
  display:grid; place-items:center;
}
.ring{
  width:100%; height:100%; border-radius:50%;
  background: conic-gradient(var(--ring-color,#60a5fa) calc(var(--val)*1%), rgba(255,255,255,.12) 0);
  mask: radial-gradient(circle at 50% 50%, transparent 60%, black 61%);
  -webkit-mask: radial-gradient(circle at 50% 50%, transparent 60%, black 61%);
}
.score{
  position:absolute; top:30%; font-size:24px; font-weight:800; color:#fff;
  text-align:center; width:100%;
}
.tag{
  position:absolute; bottom:15%; font-size:14px; font-weight:700; color:#fff; width:100%; text-align:center;
}
.right h3{margin:0 0 8px; font-size:18px;}
.right p, .right ul{opacity:.85; margin-top:6px; font-size:14px; line-height:1.6;}
.right ul{padding-left:24px; margin-top:12px;}
.right ul li{margin-bottom:12px;}
.actions{margin-top:10px; display:flex; gap:12px; flex-wrap:wrap}
.loading{display:inline-flex; align-items:center; gap:10px; color:#bfdbfe; font-weight:600;}
.spinner{width:18px; height:18px; border-radius:50%; border:3px solid rgba(148,163,184,.25); border-top-color:#93c5fd; animation:spin .8s linear infinite;}
@keyframes spin {to{transform:rotate(360deg)}}
.error{background: rgba(239,68,68,.12); border-color: rgba(239,68,68,.35); color:#fecaca; margin-top:10px; padding:10px; border-radius:12px;}
</style>
</head>
<body>
<div class="shell">
    <section class="hero">
        <h1 class="title">Check Your Job‚Äôs AI Risk</h1>
        <p class="subtitle">Instant, personalized analysis with score, explanation, tools, and roadmap</p>
    </section>

    <section class="panel">
        <form class="query" id="riskForm">
            <input id="jobInput" class="input" type="text"
                   placeholder="e.g., Graphic Designer, SQL Developer, HR Manager" autocomplete="on" required/>
            <button id="checkBtn" class="btn" type="submit">Check</button>
            <span id="loadState" class="loading" style="display:none"><span class="spinner"></span>Analyzing‚Ä¶</span>
        </form>
    </section>

    <section id="results" class="grid" style="display:none"></section>
    <section id="errorBox" class="panel card error" style="display:none"></section>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const form = document.getElementById('riskForm');
const input = document.getElementById('jobInput');
const btn = document.getElementById('checkBtn');
const load = document.getElementById('loadState');
const results = document.getElementById('results');
const errorBox = document.getElementById('errorBox');

const learningLinks = {
  "Python":"https://www.learnpython.org/",
  "SQL":"https://www.w3schools.com/sql/",
  "TensorFlow":"https://www.tensorflow.org/",
  "PowerBI":"https://learn.microsoft.com/en-us/power-bi/",
  "Tableau":"https://www.tableau.com/learn/training",
  "ChatGPT":"https://chat.openai.com",
  "MidJourney":"https://www.midjourney.com/"
};

function getSkillLink(skill) {
  return learningLinks[skill]
    ? `<a href="${learningLinks[skill]}" target="_blank">${skill}</a>`
    : skill;
}

function isValidJobInput(text) {
  return /^[a-zA-Z\s\-&,]+$/.test(text);
}

input.addEventListener('input', () => {
  const valid = isValidJobInput(input.value.trim()) || input.value.trim() === '';
  input.style.borderColor = valid ? 'rgba(255,255,255,.12)' : '#ef4444';

  if (input.value.trim() === '') {
    results.style.display = 'none';
    results.innerHTML = '';
    errorBox.style.display = 'none';
  }
});

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const job = input.value.trim();
  if (!job) {
    errorBox.textContent = 'Error: Please enter a job title.';
    errorBox.style.display = 'block';
    return;
  }
  if (!isValidJobInput(job)) {
    errorBox.textContent = 'Error: Please enter a valid job title (letters, spaces, -, &, , allowed).';
    errorBox.style.display = 'block';
    return;
  }

  btn.disabled = true; load.style.display = 'inline-flex';
  errorBox.style.display = 'none'; results.style.display = 'none';

  try {
    const res = await fetch('/check_job', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ job_title: job })
    });
    if (!res.ok) throw new Error('Network error');
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    const risk = Math.max(0, Math.min(Number(data.risk_score ?? data.risk ?? 0), 100));
    let tagText = '', color = '', timeframe = '';

    if (risk < 40) { tagText = 'LOW'; color = '#22c55e'; timeframe = '3‚Äì5 years'; }
    else if (risk < 70) { tagText = 'MEDIUM'; color = '#f59e0b'; timeframe = '2‚Äì4 years'; }
    else { tagText = 'HIGH'; color = '#ef4444'; timeframe = '1‚Äì2 years'; }

    const dynamicSummary = `${tagText} automation risk for ${job} over the next ${timeframe}`;
    const tools = Array.isArray(data.tools) ? data.tools : [];

    const previewUrl = `${window.location.origin}/preview/${encodeURIComponent(job)}`;

    results.innerHTML = `<div class="card">
      <div class="meter-container">
        <div class="meter">
          <div class="ring" style="--val:${risk}; --ring-color:${color}"></div>
          <div class="score">${risk}%</div>
          <div class="tag">${tagText}</div>
        </div>
      </div>
      <div class="right">
        <h3 style="color:${color}">${job}</h3>
        <p style="color:lightblue">${dynamicSummary}</p>
        <h4 style="color:#60a5fa">AI Tools to Learn:</h4>
        <ul id="toolsList"></ul>
        <h4 style="color:#f59e0b">Why This Score:</h4>
        <ul>${Array.isArray(data.factors) ? data.factors.map(f => `<li>${f}</li>`).join('') : '<li>‚Äî</li>'}</ul>
        <h4 style="color:#a78bfa">Roadmap (1‚Äì2 months):</h4>
        <ul>${Array.isArray(data.roadmap) ? data.roadmap.map(r => `<li>${r}</li>`).join('') : '<li>‚Äî</li>'}</ul>
      </div>
      <div class="actions">
        <a href="https://twitter.com/intent/tweet?text=Check+${encodeURIComponent(job)}+AI+Risk&url=${encodeURIComponent(previewUrl)}" target="_blank" class="btn">üê¶ Twitter</a>
        <a href="https://api.whatsapp.com/send?text=Check+${encodeURIComponent(job)}+AI+Risk+${encodeURIComponent(previewUrl)}" target="_blank" class="btn">üí¨ WhatsApp</a>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(previewUrl)}" target="_blank" class="btn" style="background: linear-gradient(90deg, #0A66C2, #004182); color:white">üíº LinkedIn</a>
        <button onclick="generatePDF()" class="btn" style="background: linear-gradient(90deg, #f59e0b, #d97706); color:white">üìÑ Generate PDF</button>
      </div>
    </div>`;

    // Render AI Tools clickable links
    const toolsListEl = document.getElementById('toolsList');
    toolsListEl.innerHTML = '';
    tools.forEach(tool => {
      const match = tool.match(/^(.*?)\s*\((https?:\/\/.*?)\)$/);
      if (match) {
        const li = document.createElement('li');
        li.innerHTML = `<a href="${match[2]}" target="_blank">${match[1]}</a>`;
        toolsListEl.appendChild(li);
      } else {
        const li = document.createElement('li');
        li.textContent = tool;
        toolsListEl.appendChild(li);
      }
    });

    results.style.display = 'grid';
    results.scrollIntoView({ behavior: 'smooth' });
  } catch (err) {
    errorBox.textContent = `Error: ${err.message}`;
    errorBox.style.display = 'block';
  } finally {
    btn.disabled = false; load.style.display = 'none';
  }
});

// PDF generation
function generatePDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y = 10;
  pdf.setFontSize(18);
  pdf.text("AI Risk Report", 10, y);
  y += 10;

  pdf.setFontSize(14);
  pdf.text("AI Tools to Learn:", 10, y);
  y += 10;

  const toolsList = document.getElementById('toolsList');
  toolsList.querySelectorAll('a').forEach(a => {
    pdf.textWithLink(a.textContent, 10, y, { url: a.href });
    y += 10;
  });

  pdf.save("AI_Risk_Report.pdf");
}
</script>
</body>
</html>
